<!-- Mobile Navigation -->
<div class="block lg:hidden">
    <div class="fixed bottom-0 left-0 right-0 w-full rounded-t-3xl bg-emerald-900 dark:bg-gray-800 border-t border-emerald-700 z-50">
        <div class="flex justify-around p-2 text-white max-w-7xl mx-auto">
            <a href="{% url 'core:home' %}" 
               class="flex flex-col items-center justify-center hover:scale-105 transition-transform duration-200 rounded-xl px-3 py-2 {% if request.resolver_match.url_name == 'home' %}bg-amber-900{% endif %}">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-bank" viewBox="0 0 16 16">
                    <path d="m8 0 6.61 3h.89a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5H15v7a.5.5 0 0 1 .485.38l.5 2a.498.498 0 0 1-.485.62H.5a.498.498 0 0 1-.485-.62l.5-2A.5.5 0 0 1 1 13V6H.5a.5.5 0 0 1-.5-.5v-2A.5.5 0 0 1 .5 3h.89zM3.777 3h8.447L8 1zM2 6v7h1V6zm2 0v7h2.5V6zm3.5 0v7h1V6zm2 0v7H12V6zM13 6v7h1V6zm2-1V4H1v1zm-.39 9H1.39l-.25 1h13.72z"/>
                </svg>
                <p class="mt-1 text-center text-xs">Home</p>
            </a>
            
            <a href="{% url 'core:wallet' %}" 
               class="flex flex-col items-center justify-center hover:scale-105 transition-transform duration-200 rounded-xl px-3 py-2 {% if request.resolver_match.url_name == 'wallet' %}bg-amber-900{% endif %}">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-wallet" viewBox="0 0 16 16">
                    <path d="M0 3a2 2 0 0 1 2-2h13.5a.5.5 0 0 1 0 1H15v2a1 1 0 0 1 1 1v8.5a1.5 1.5 0 0 1-1.5 1.5h-12A2.5 2.5 0 0 1 0 12.5zm1 1.732V12.5A1.5 1.5 0 0 0 2.5 14h12a.5.5 0 0 0 .5-.5V5H2a2 2 0 0 1-1-.268M1 3a1 1 0 0 0 1 1h12V2H2a1 1 0 0 0-1 1"/>
                </svg>
                <p class="mt-1 text-center text-xs">Wallet</p>
            </a>
            
            <a href="{% url 'core:assets' %}" 
               class="flex flex-col items-center justify-center hover:scale-105 transition-transform duration-200 rounded-xl px-3 py-2 {% if 'assets' in request.resolver_match.url_name %}bg-amber-900{% endif %}">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-currency-exchange" viewBox="0 0 16 16">
                    <path d="M0 5a5 5 0 0 0 4.027 4.905 6.5 6.5 0 0 1 .544-2.073C3.695 7.536 3.132 6.864 3 5.91h-.5v-.426h.466V5.05q-.001-.07.004-.135H2.5v-.427h.511C3.236 3.24 4.213 2.5 5.681 2.5c.316 0 .59.031.819.085v.733a3.5 3.5 0 0 0-.815-.082c-.919 0-1.538.466-1.734 1.252h1.917v.427h-1.98q-.004.07-.003.147v.422h1.983v.427H3.93c.118.602.468 1.03 1.005 1.229a6.5 6.5 0 0 1 4.97-3.113A5.002 5.002 0 0 0 0 5m16 5.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0m-7.75 1.322c.069.835.746 1.485 1.964 1.562V14h.54v-.62c1.259-.086 1.996-.74 1.996-1.69 0-.865-.563-1.31-1.57-1.54l-.426-.1V8.374c.54.06.884.347.966.745h.948c-.07-.804-.779-1.433-1.914-1.502V7h-.54v.629c-1.076.103-1.808.732-1.808 1.622 0 .787.544 1.288 1.45 1.493l.358.085v1.78c-.554-.08-.92-.376-1.003-.787zm1.96-1.895c-.532-.12-.82-.364-.82-.732 0-.41.311-.719.824-.809v1.54h-.005zm.622 1.044c.645.145.943.38.943.796 0 .474-.37.8-1.02.86v-1.674z"/>
                </svg>
                <p class="mt-1 text-center text-xs">Assets</p>
            </a>
            
            <a href="{% url 'accounts:profile' %}" 
               class="flex flex-col items-center justify-center hover:scale-105 transition-transform duration-200 rounded-xl px-3 py-2 {% if request.resolver_match.url_name == 'profile' %}bg-amber-900{% endif %}">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person-vcard-fill" viewBox="0 0 16 16">
                    <path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm9 1.5a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 0-1h-4a.5.5 0 0 0-.5.5M9 8a.5.5 0 0 0 .5.5h4a.5.5 0 0 0 0-1h-4A.5.5 0 0 0 9 8m1 2.5a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 0-1h-3a.5.5 0 0 0-.5.5m-1 2C9 10.567 7.21 9 5 9c-2.086 0-3.8 1.398-3.984 3.181A1 1 0 0 0 2 13h6.96q.04-.245.04-.5M7 6a2 2 0 1 0-4 0 2 2 0 0 0 4 0"/>
                </svg>
                <p class="mt-1 text-center text-xs">Account</p>
            </a>
        </div>
    </div>
</div>

<!-- Mobile Header -->
<div class="fixed top-0 z-40 bg-emerald-900 text-white backdrop-blur transition-all duration-500 block lg:hidden p-4 dark:bg-gray-800 w-full">
    <div class="flex justify-between items-center max-w-4xl mx-auto w-full">
        <div class="flex-shrink-0">
            <a href="{% url 'core:home' %}" class="flex items-center space-x-2 hover:scale-105 transition-transform duration-200">
                <span class="text-yellow-700 font-bold text-2xl">Pesa</span>
                <span class="text-teal-300 font-bold">Prime</span>
            </a>
        </div>
        
        <!-- Currency Dropdown -->
        <form method="POST" action="{% url 'core:switch_currency' %}">
                {% csrf_token %}

                <div class="flex items-center gap-2 bg-emerald-800 text-white px-3 py-2 rounded-lg">

                    <!-- Icon (works correctly here) -->
                    <svg xmlns="http://www.w3.org/2000/svg" 
                        width="20" height="20" fill="currentColor" 
                        class="bi bi-cash-coin">
                        <path fill-rule="evenodd"
                            d="M11 15a4 4 0 1 0 0-8 4 4 0 0 0 0 8m5-4a5 5 0 1 1-10 0 5 5 0 0 1 10 0"/>
                        <path
                            d="M9.438 11.944c.047.596.518 1.06 1.363 1.116v.44h.375v-.443c.875-.061 1.386-.529 1.386-1.207 
                            0-.618-.39-.936-1.09-1.1l-.296-.07v-1.2c.376.043.614.248.671.532h.658c-.047-.575-.54-1.024-1.329-1.073V8.5h-.375v.45
                            c-.747.073-1.255.522-1.255 1.158 0 .562.378.92 1.007 1.066l.248.061v1.272c-.384-.058-.639-.27-.696-.563h-.668zm1.36-1.354
                            c-.369-.085-.569-.26-.569-.522 0-.294.216-.514.572-.578v1.1zm.432.746c.449.104.655.272.655.569 0 .339-.257.571-.709.614
                            v-1.195z"/>
                        <path
                            d="M1 0a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h4.083q.088-.517.258-1H3a2 2 0 0 0-2-2V3a2 2 0 0 0 2-2h10a2 2 0 0 0 2 2v3.528
                            c.38.34.717.728 1 1.154V1a1 1 0 0 0-1-1z"/>
                        <path
                            d="M9.998 5.083 10 5a2 2 0 1 0-3.132 1.65 6 6 0 0 1 3.13-1.567"/>
                    </svg>

                    <!-- Select Currency -->
                    <select name="currency" onchange="this.form.submit()"
                            class="bg-transparent text-white focus:outline-none cursor-pointer">
                        {% for currency in available_currencies %}
                            <option value="{{ currency.code }}"
                                    class="text-black"
                                    {% if current_currency.code == currency.code %}selected{% endif %}>
                                {{ currency.code }} 
                            </option>
                        {% endfor %}
                    </select>
                </div>

            </form>
        <!-- Theme Toggle for Mobile -->
         {% comment %} <button id="mobile-theme-toggle" class="p-2 rounded-lg bg-emerald-800 hover:bg-emerald-700">
            {% if theme == 'dark' %}
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fillRule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clipRule="evenodd"/>
            </svg>
            {% else %}
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
            </svg>
            {% endif %}
        </button>  {% endcomment %}
    </div>
</div>

<script>
    // Mobile theme toggle
    document.getElementById('mobile-theme-toggle')?.addEventListener('click', function() {
        const isDark = document.documentElement.classList.contains('dark');
        document.documentElement.classList.toggle('dark');
        document.cookie = `theme=${isDark ? 'light' : 'dark'}; path=/; max-age=31536000`;
        
        if ('{{ user.is_authenticated }}' === 'True') {
            fetch('/accounts/update-theme/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: JSON.stringify({ theme: isDark ? 'light' : 'dark' })
            });
        }
    });
</script>